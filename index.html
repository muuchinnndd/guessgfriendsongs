<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœæ­Œå°éŠæˆ²</title>
    <style>
        :root {
            --primary: #5F4B8B; /* ç´«è‰² */
            --secondary: #00B2CA; /* è—ç¶ è‰² */
            --bg: #F0EEE9; /* ç±³è‰²èƒŒæ™¯ */
            --text: #333;
            --correct: #4CAF50;
            --wrong: #f44336;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text);
        }

        .container {
            width: 90%;
            max-width: 600px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(95, 75, 139, 0.2);
            text-align: center;
        }

        h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: #666;
        }

        /* æ’­æ”¾æŒ‰éˆ•å€åŸŸ */
        .player-box {
            background: var(--primary);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .play-btn {
            background: var(--secondary);
            border: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            color: white;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }

        .play-btn:active {
            transform: scale(0.95);
        }

        .play-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* é¸é …æŒ‰éˆ• */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-btn:hover {
            background: var(--bg);
        }

        /* æ‰‹æ©Ÿç‰ˆè®Šæˆå–®æ¬„ */
        @media (max-width: 480px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        /* è§£ç­”é¡¯ç¤ºå€ */
        .result-overlay {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.3s;
        }

        .album-cover {
            width: 150px;
            height: 150px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin: 10px auto;
            object-fit: cover;
        }

        .song-info {
            font-size: 1.2em;
            color: var(--primary);
            margin: 10px 0;
            font-weight: bold;
        }

        .next-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* è¼‰å…¥ç•«é¢ */
        #loading-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        
        .loader {
            border: 5px solid #ccc;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ç‹€æ…‹æ¨£å¼ */
        .correct-bg { background-color: var(--correct) !important; color: white !important; border-color: var(--correct) !important; }
        .wrong-bg { background-color: var(--wrong) !important; color: white !important; border-color: var(--wrong) !important; }

    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loader"></div>
        <p id="loading-text" style="margin-top:20px; color: var(--primary);">Loading... (0%)</p>
    </div>

    <div class="container" id="game-container" style="display: none;">
        <div class="status-bar">
            <span id="progress-text">ç¬¬ 1 / 20 é¡Œ</span>
            <span id="score-text">å¾—åˆ†: 0</span>
        </div>

        <div class="player-box">
            <p>é»æ“Šæ’­æ”¾è©¦è½</p>
            <button class="play-btn" id="play-btn" onclick="playSnippet()">â–¶</button>
        </div>

        <div class="options-grid" id="options-area">
            </div>

        <div class="result-overlay" id="result-area">
            <h2 id="result-title">æ­£ç¢ºï¼</h2>
            <img id="album-img" class="album-cover" src="" alt="Album Art">
            <div class="song-info">
                <div id="result-song">æ­Œå</div>
                <div id="result-artist" style="font-size: 0.8em; color: #666;">æ­Œæ‰‹</div>
            </div>
            <button class="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <div class="container" id="end-screen" style="display: none;">
        <h1>éŠæˆ²çµæŸ</h1>
        <p style="font-size: 20px;">ä½ çš„ç¸½åˆ†</p>
        <h2 style="font-size: 50px; color: var(--secondary); margin: 0;" id="final-score">0</h2>
        <p>æ»¿åˆ†: <span id="max-score">100</span></p>
        <button class="next-btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        // ==========================================
        //  â–¼ é¡Œåº«æ¨¡æ¿ (è«‹åœ¨é€™è£¡ç·¨è¼¯ä½ æƒ³åŠ å…¥çš„æ­Œ) â–¼
        //  æ ¼å¼ï¼š"æ­Œå æ­Œæ‰‹å" (è¶Šç²¾æº–è¶Šå¥½)
        // ==========================================
        const songRequests = [
            "Glass Bead ìœ ë¦¬êµ¬ìŠ¬ GFRIEND",
            "Me gustas tu GFRIEND",
            "1754048194",
            "ë„ˆ ê·¸ë¦¬ê³  ë‚˜ (NAVILLERA) GFRIEND",
            "FINGERTIP GFRIEND",
            "Love Whisper GFRIEND",
            "Summer Rain GFRIEND",
            "Time for the moon night ë°¤ GFRIEND",
            "Sunny Summer ì—¬ë¦„ì—¬ë¦„í•´ GFRIEND",
            "Sunrise GFRIEND í•´ì•¼",
            "Fever GFRIEND",
            "Crossroads GFRIEND",
            "Apple GFRIEND",
            "MAGO GFRIEND",
            "White GFRIEND",
            "Neverland GFRIEND",
            "Under The Sky í•˜ëŠ˜ ì•„ë˜ì„œ GFRIEND",
            "One GFRIEND",
            "My Buddy GFRIEND",
            "Say My Name GFRIEND",
            "Someday GFRIEND",
            "Trust GFRIEND",
            "LuvStar GFRIEND",
            "Fall in Love GFRIEND",
            "1754049862",
			"í•œ ë¼˜ (Distance) GFRIEND ",
			"Water Flower GFRIEND",
			"Mermaid GFRIEND",
			"Sunshine GFRIEND",
			"Compas GFRIEND",
			"Click GFRIEND ì°°ì¹µ",
			"Gone with the wind GFRIEND",
			"Hear The Wind Sing GFRIEND",
			"Contrail GFRIEND",
			"Please Save My Earth GFRIEND",
			"Rain in the Spring Time GFRIEND",
			"Crush GFRIEND",
			"RAINBOW GFRIEND ì—¬ìì¹œêµ¬",
			"Ave Maria GFRIEND",
			"One-Half GFRIEND",
			"Life is a Party GFRIEND",
			"Red Umbrella GFRIEND",
			"Falling Asleep Again GFRIEND",
			"Love Bug GFRIEND",
			"Flower Garden GFRIEND",
			"Tik Tik GFRIEND ì—¬ìì¹œêµ¬",
			"Bye GFRIEND",
			"You are my star GFRIEND",
			"Vacation GFRIEND ì—¬ìì¹œêµ¬",
			"Sweety GFRIEND",
			"Windy Windy GFRIEND",
			"Love in the air GFRIEND",
			"You are not alone GFRIEND ì—¬ìì¹œêµ¬",
			"L.U.V. GFRIEND",
			"GLOW GFRIEND",
			"Our Secret GFRIEND",
			"Only 1 GFRIEND",
			"Truly Love GFRIEND",
			"Show Up GFRIEND",
			"It's you GFRIEND",
			"A starry sky GFRIEND",
			"1754045818",
			"Memoria(Korean ver.) GFRIEND ì—¬ìì¹œêµ¬",
			"Mr.Blue GFRIEND ì—¬ìì¹œêµ¬",
			"Smile GFRIEND",
			"Wish GFRIEND ì—¬ìì¹œêµ¬",
			"Paradise GFRIEND ì—¬ìì¹œêµ¬",
			"Hope ê¸°ëŒ€ GFRIEND",
			"FLOWER(Korean var.) GFRIEND ì—¬ìì¹œêµ¬",
			"Labyrinth GFRIEND",
			"Here We Are GFRIEND ì—¬ìì¹œêµ¬",
			"Eclipse ì§€ê¸ˆ ë§Œë‚˜ëŸ¬ ê°‘ë‹ˆë‹¤ GFRIEND",
			"Dreamcatcher GFRIEND",
			"From me GFRIEND ì—¬ìì¹œêµ¬",
			"Eye of the storm GFRIEND",
			"Room of mirrors GFRIEND",
			"Tarot Cards GFRIEND",
			"CrÃ¨me BrÃ»lÃ©e GFRIEND ì—¬ìì¹œêµ¬",
			"Stairs in the North ë¶ìª½ ê³„ë‹¨ GFRIEND",
			"Love Spell GFRIEND ì—¬ìì¹œêµ¬",
			"GRWM GFRIEND ì—¬ìì¹œêµ¬",
			"Three of Cups GFRIEND",
			"Secret Diary GFRIEND",
			"Better Me GFRIEND ì—¬ìì¹œêµ¬",
			"Night Drive GFRIEND ì—¬ìì¹œêµ¬",
			"Wheel of the year ì•ë©´ì˜ ë’·ë©´ì˜ ë’·ë©´ GFRIEND",
			"Season of memories ìš°ë¦¬ì˜ ë‹¤ì •í•œ ê³„ì ˆ ì†ì— GFRIEND",
			"Always GFRIEND ì—¬ìì¹œêµ¬",
        ];
        // å»ºè­°è‡³å°‘å¡«å¯« 25 é¦–ä»¥ä¸Šï¼Œä»¥å…é¡Œç›®é‡è¤‡æˆ– API æŠ“ä¸åˆ°æŸäº›æ­Œ
        // ==========================================

        let songDatabase = []; // å­˜æ”¾æŠ“å–å›ä¾†çš„å®Œæ•´è³‡æ–™
        let currentQuestions = []; // æœ¬å±€çš„é¡Œç›®åˆ—è¡¨
        let currentQIndex = 0;
        let score = 0;
        let audioPlayer = new Audio();
        let isPlaying = false;
        let playTimeout;
        const TOTAL_QUESTIONS = 20;

        // åˆå§‹åŒ–ï¼šæŠ“å–è³‡æ–™
        window.onload = async function() {
            const loadingText = document.getElementById('loading-text');
            let successCount = 0;
            const banList = ["instrumental", "karaoke", "ä¼´å¥", "off vocal", "backing track"];

            for (let i = 0; i < songRequests.length; i++) {
                const term = songRequests[i].trim();
                loadingText.innerHTML = `é€²åº¦: ${Math.round((i / songRequests.length) * 100)}%`;
                
                try {
                    let finalTrack = null;

                    // åˆ¤æ–·æ˜¯å¦ç‚ºç´”æ•¸å­— (Track ID æ¨¡å¼)
                    if (/^\d+$/.test(term)) {
                        // ä½¿ç”¨ lookup API ç›´æ¥æŠ“å– ID
                        const res = await fetch(`https://itunes.apple.com/lookup?id=${term}&country=TW`);
                        const data = await res.json();
                        if (data.resultCount > 0) {
                            finalTrack = data.results[0];
                        }
                    } else {
                        // ä½¿ç”¨ search API (æœå°‹æ¨¡å¼)
                        const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&limit=10&media=music&country=TW`);
                        const data = await res.json();
                        
                        if (data.resultCount > 0) {
                            // éæ¿¾æ‰æ¼”å¥ç‰ˆ
                            finalTrack = data.results.find(t => {
                                const lowerName = t.trackName.toLowerCase();
                                const lowerCollection = (t.collectionName || "").toLowerCase();
                                return !banList.some(banWord => lowerName.includes(banWord) || lowerCollection.includes(banWord));
                            }) || data.results[0];
                        }
                    }

                    if (finalTrack) {
                        console.log(`[æˆåŠŸ] é—œéµå­—/ID: ${term} -> æŠ“åˆ°: ${finalTrack.trackName}`);
                        songDatabase.push({
                            title: finalTrack.trackName,
                            artist: finalTrack.artistName,
                            previewUrl: finalTrack.previewUrl,
                            cover: finalTrack.artworkUrl100.replace('100x100', '400x400'), // å°é¢æ”¹æ›´å¤§å¼µ
                            id: finalTrack.trackId
                        });
                        successCount++;
                    } else {
                        console.warn(`[å¤±æ•—] æ‰¾ä¸åˆ°æ­Œæ›²: ${term}`);
                    }
                } catch (e) {
                    console.error("Fetch error:", term, e);
                }
            }

            if (successCount < 4) {
                alert("æŠ“å–åˆ°çš„æ­Œæ›²å¤ªå°‘ï¼Œè«‹æª¢æŸ¥é¡Œåº« ID æˆ–åç¨±ã€‚");
                return;
            }
            startGame();
        };

        function startGame() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            // éš¨æ©Ÿé¸å‡º TOTAL_QUESTIONS é¡Œ (å¦‚æœä¸å¤ å°±å…¨é¸)
            const shuffledDb = songDatabase.sort(() => 0.5 - Math.random());
            currentQuestions = shuffledDb.slice(0, Math.min(TOTAL_QUESTIONS, shuffledDb.length));
            
            score = 0;
            currentQIndex = 0;
            loadQuestion();
        }

        function loadQuestion() {
            // é‡ç½®ä»‹é¢
            document.getElementById('result-area').style.display = 'none';
            document.getElementById('options-area').innerHTML = '';
            document.getElementById('play-btn').disabled = false;
            document.getElementById('play-btn').innerText = 'â–¶';
            
            // æ›´æ–°ç‹€æ…‹åˆ—
            document.getElementById('progress-text').innerText = `ç¬¬ ${currentQIndex + 1} / ${currentQuestions.length} é¡Œ`;
            document.getElementById('score-text').innerText = `å¾—åˆ†: ${score}`;

            if (currentQIndex >= currentQuestions.length) {
                endGame();
                return;
            }

            const currentSong = currentQuestions[currentQIndex];

            // ç”¢ç”Ÿå¹²æ“¾é … (å¾è³‡æ–™åº«ä¸­éš¨æ©ŸæŒ‘é¸ 3 å€‹ä¸æ˜¯é€™é¦–æ­Œçš„é¸é …)
            let otherSongs = songDatabase.filter(s => s.id !== currentSong.id);
            let wrongOptions = otherSongs.sort(() => 0.5 - Math.random()).slice(0, 3);
            
            // æ··åˆé¸é …
            let options = [currentSong, ...wrongOptions];
            options.sort(() => 0.5 - Math.random());

            // æ¸²æŸ“æŒ‰éˆ•
            const optionsArea = document.getElementById('options-area');
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = `${opt.title}`; // é¡¯ç¤ºæ­Œå+æ­Œæ‰‹ä»¥é™ä½é›£åº¦ï¼Œä¹Ÿå¯åªé¡¯ç¤ºæ­Œå
                btn.onclick = () => checkAnswer(opt, btn, currentSong);
                optionsArea.appendChild(btn);
            });

            // é å‚™éŸ³è¨Š
            audioPlayer.src = currentSong.previewUrl;
            audioPlayer.load();
        }

        function playSnippet() {
            if (isPlaying) return;
            
            const btn = document.getElementById('play-btn');
            btn.disabled = true;
            btn.innerText = 'ğŸ”Š';
            
            audioPlayer.currentTime = 0; // å¾é ­æ’­æ”¾
            audioPlayer.play();
            isPlaying = true;

            // 3ç§’å¾Œåœæ­¢
            playTimeout = setTimeout(() => {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                isPlaying = false;
                btn.disabled = false;
                btn.innerText = 'â–¶';
            }, 1300); // é€™è£¡å¯ä»¥èª¿æ•´ç§’æ•¸ï¼Œä¾‹å¦‚ 2000 ç‚º 2ç§’
        }

        function checkAnswer(selected, btnElement, correctSong) {
            // åœæ­¢æ’­æ”¾
            clearTimeout(playTimeout);
            audioPlayer.pause();
            isPlaying = false;
            document.getElementById('play-btn').innerText = 'â–¶';

            // é–å®šæ‰€æœ‰æŒ‰éˆ•
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.disabled = true);

            const isCorrect = selected.id === correctSong.id;
            const resultTitle = document.getElementById('result-title');
            
            if (isCorrect) {
                btnElement.classList.add('correct-bg');
                resultTitle.innerText = "ç­”å°äº†ï¼ğŸ‰";
                resultTitle.style.color = "var(--correct)";
                score += 10;
            } else {
                btnElement.classList.add('wrong-bg');
                resultTitle.innerText = "ç­”éŒ¯äº†... ğŸ˜¢";
                resultTitle.style.color = "var(--wrong)";
                
                // æ¨™ç¤ºå‡ºæ­£ç¢ºç­”æ¡ˆ
                allBtns.forEach(b => {
                    if (b.innerText.includes(correctSong.title)) {
                        b.classList.add('correct-bg');
                    }
                });
            }

            // é¡¯ç¤ºå°é¢èˆ‡è³‡è¨Š
            document.getElementById('album-img').src = correctSong.cover;
            document.getElementById('result-song').innerText = correctSong.title;
            document.getElementById('result-artist').innerText = correctSong.artist;
            document.getElementById('result-area').style.display = 'block';
            
            document.getElementById('score-text').innerText = `å¾—åˆ†: ${score}`;
        }

        function nextQuestion() {
            currentQIndex++;
            loadQuestion();
        }

        function endGame() {
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
            document.getElementById('max-score').innerText = currentQuestions.length * 10;
        }
    </script>
</body>
</html>